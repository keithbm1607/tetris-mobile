<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Tetris – Mobile First (v3)</title>
  <style>
    :root{--bg:#0f172a;--panel:#0b1020;--fg:#e2e8f0;--grid:#1f2937}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    body{overscroll-behavior:none; touch-action:none;}
    .wrap{max-width:920px;margin:0 auto;padding:12px 16px 96px}
    h1{font-size:clamp(18px,3vw,22px);margin:8px 0 6px;font-weight:700}
    .hud{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .pill{background:#111827;border:1px solid #334155;padding:6px 10px;border-radius:999px;font-size:14px}
    .btn{cursor:pointer;background:#111827;border:1px solid #334155;color:var(--fg);padding:8px 12px;border-radius:10px;font-weight:600}
    .btn:hover{background:#0b1220}
    .gamewrap{display:grid;grid-template-columns:minmax(240px,1fr) 220px;gap:16px}
    canvas{width:100%;height:auto;background:var(--panel);border:1px solid #334155;border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.35) inset; touch-action:none;}
    .side{display:flex;flex-direction:column;gap:8px}
    .box{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:10px}
    .label{opacity:.8;font-size:12px;margin-bottom:4px}
    .next{display:flex;gap:6px;flex-wrap:wrap}
    .mini{width:60px;height:60px;background:#0b1220;border:1px solid #1f2937;border-radius:8px;display:grid;place-items:center}
    .controls{position:fixed;left:0;right:0;bottom:12px;display:flex;gap:10px;justify-content:center;padding:0 12px;z-index:10}
    .tbtn{flex:1;max-width:120px;height:56px;background:rgba(17,24,39,.85);color:#e5e7eb;border:1px solid #334155;border-radius:14px;font-weight:700;font-size:16px}
    @media (hover:hover) and (pointer:fine){.controls{display:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Tetris – Mobile First (v3)</h1>
    <div class="hud">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="pill">Score: <span id="score">0</span></span>
        <span class="pill">Lines: <span id="lines">0</span></span>
        <span class="pill">Level: <span id="level">1</span></span>
      </div>
      <div style="display:flex;gap:8px">
        <button id="startBtn" class="btn">Start</button>
        <button id="pauseBtn" class="btn">Pause</button>
        <button id="resetBtn" class="btn">Reset</button>
      </div>
    </div>

    <div class="gamewrap">
      <canvas id="board" width="360" height="720" aria-label="Tetris board"></canvas>
      <div class="side">
        <div class="box">
          <div class="label">Next</div>
          <div id="next" class="next"></div>
        </div>
        <div class="box">
          <div class="label">How to play (phone)</div>
          <div style="font-size:13px;line-height:1.45">
            Tap the board or press Start to play. Use ◀ ▶ to move, ⟳ to rotate, ⬇︎ to drop.<br/>
            Tip: Add to Home Screen for fullscreen play.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button id="cLeft" class="tbtn">◀</button>
    <button id="cRotate" class="tbtn">⟳</button>
    <button id="cRight" class="tbtn">▶</button>
    <button id="cDrop" class="tbtn">⬇︎</button>
  </div>

<script>
(() => {
  const W=10, H=20, tile=36, gravityBaseMs=800;
  const colors={I:'#06b6d4',J:'#3b82f6',L:'#f59e0b',O:'#eab308',S:'#22c55e',T:'#a855f7',Z:'#ef4444'};
  const shapes={I:[[1,1,1,1]],J:[[1,0,0],[1,1,1]],L:[[0,0,1],[1,1,1]],O:[[1,1],[1,1]],S:[[0,1,1],[1,1,0]],T:[[0,1,0],[1,1,1]],Z:[[1,1,0],[0,1,1]]};
  const order=['I','J','L','O','S','T','Z'];

  const board=document.getElementById('board');
  const ctx=board.getContext('2d',{alpha:false});
  const nextWrap=document.getElementById('next');
  const scoreEl=document.getElementById('score');
  const linesEl=document.getElementById('lines');
  const levelEl=document.getElementById('level');
  const startBtn=document.getElementById('startBtn');
  const pauseBtn=document.getElementById('pauseBtn');
  const resetBtn=document.getElementById('resetBtn');

  let grid,curr,nextQueue;
  let score=0,lines=0,level=1;
  let running=false,over=false;
  let dropTimer=0,dropInterval=gravityBaseMs;
  let lastTime=0;

  function makeGrid(){return Array.from({length:H},()=>Array(W).fill(null));}
  function piece(k){return {kind:k,x:Math.floor(W/2)-2,y:0,m:shapes[k].map(r=>r.slice())};}
  function rotateCW(m){const h=m.length,w=m[0].length,r=[];for(let x=0;x<w;x++){r[x]=[];for(let y=0;y<h;y++){r[x][y]=m[h-1-y][x];}}return r;}
  function rotateCCW(m){const h=m.length,w=m[0].length,r=[];for(let x=0;x<w;x++){r[x]=[];for(let y=0;y<h;y++){r[x][y]=m[y][w-1-x];}}return r;}

  function collide(g,p){for(let y=0;y<p.m.length;y++){for(let x=0;x<p.m[0].length;x++){if(!p.m[y][x])continue;const nx=p.x+x,ny=p.y+y;if(nx<0||nx>=W||ny>=H)return true;if(ny>=0&&g[ny][nx])return true;}}return false;}
  function merge(g,p){for(let y=0;y<p.m.length;y++){for(let x=0;x<p.m[0].length;x++){if(p.m[y][x]){const nx=p.x+x,ny=p.y+y;if(ny>=0)g[ny][nx]=p.kind;}}}}
  function clearLines(){let c=0;for(let y=H-1;y>=0;y--){if(grid[y].every(v=>v)){grid.splice(y,1);grid.unshift(Array(W).fill(null));c++;y++;}}if(c){const pts=[0,100,300,500,800][c]*level;score+=pts;lines+=c;level=1+Math.floor(lines/10);dropInterval=Math.max(90,gravityBaseMs-(level-1)*60);updateHUD();}}
  function spawn(){if(nextQueue.length<5)refillBag();curr=piece(nextQueue.shift());if(collide(grid,curr)){over=true;running=false;}renderNext();}
  function refillBag(){const b=[...order];for(let i=b.length-1;i>0;i--){const j=(Math.random()*(i+1))|0;[b[i],b[j]]=[b[j],b[i]];}nextQueue.push(...b);}
  function updateHUD(){scoreEl.textContent=score;linesEl.textContent=lines;levelEl.textContent=level;}

  function drawCell(x,y,color){const px=x*tile,py=y*tile;ctx.fillStyle=color;ctx.fillRect(px+1,py+1,tile-2,tile-2);ctx.fillStyle='rgba(0,0,0,.15)';ctx.fillRect(px+1,py+1,tile-2,6);}
  function render(){ctx.fillStyle='#0b1020';ctx.fillRect(0,0,board.width,board.height);ctx.strokeStyle='#1f2937';for(let x=0;x<=W;x++){ctx.beginPath();ctx.moveTo(x*tile,0);ctx.lineTo(x*tile,H*tile);ctx.stroke();}for(let y=0;y<=H;y++){ctx.beginPath();ctx.moveTo(0,y*tile);ctx.lineTo(W*tile,y*tile);ctx.stroke();}for(let y=0;y<H;y++){for(let x=0;x<W;x++){const k=grid[y][x];if(k)drawCell(x,y,colors[k]);}}if(curr){for(let y=0;y<curr.m.length;y++){for(let x=0;x<curr.m[0].length;x++){if(curr.m[y][x])drawCell(curr.x+x,curr.y+y,colors[curr.kind]);}}}if(!running){ctx.save();ctx.fillStyle='rgba(0,0,0,.35)';ctx.fillRect(0,0,board.width,board.height);ctx.fillStyle='#e2e8f0';ctx.textAlign='center';ctx.font='600 22px system-ui,-apple-system,Segoe UI,Roboto';ctx.fillText(over?'Game Over – Press Reset or Start':'Tap or Press Start',board.width/2,board.height/2);ctx.restore();}}

  function tickDown(){curr.y++;if(collide(grid,curr)){curr.y--;merge(grid,curr);clearLines();spawn();return true;}return false;}
  function update(t){if(!running){render();return;}const dt=t-lastTime;lastTime=t;dropTimer+=dt;if(dropTimer>=dropInterval){dropTimer=0;tickDown();}render();requestAnimationFrame(update);}
  function move(dx){if(!curr)return;curr.x+=dx;if(collide(grid,curr))curr.x-=dx;}
  function rotate(dir){if(!curr)return;const newM=dir>0?rotateCW(curr.m):rotateCCW(curr.m);const old=curr.m;curr.m=newM;const kicks=[0,-1,1,-2,2];let ok=false;for(const k of kicks){curr.x+=k;if(!collide(grid,curr)){ok=true;break;}curr.x-=k;}if(!ok)curr.m=old;}
  function hardDrop(){while(!tickDown()){}}

  function run(){if(!running){running=true;lastTime=performance.now();requestAnimationFrame(update);render();}}
  function pause(){running=false;render();}
  function reset(){start(true);}

  startBtn.addEventListener('click',()=>{if(over){start(true);}run();});
  pauseBtn.addEventListener('click',()=>{pause();});
  resetBtn.addEventListener('click',()=>{reset();});

  board.addEventListener('pointerdown',(e)=>{e.preventDefault();if(over){start(true);}run();},{passive:false});
  const cLeft=document.getElementById('cLeft'),cRight=document.getElementById('cRight'),cRotate=document.getElementById('cRotate'),cDrop=document.getElementById('cDrop');
  function hold(btn,fn){let id=null;const down=(e)=>{e.preventDefault();fn();id=setInterval(fn,100);};const up=()=>{if(id){clearInterval(id);id=null;}};btn.addEventListener('touchstart',down,{passive:false});btn.addEventListener('touchend',up);btn.addEventListener('touchcancel',up);btn.addEventListener('mousedown',down);btn.addEventListener('mouseup',up);btn.addEventListener('mouseleave',up);}
  hold(cLeft,()=>{move(-1);render();});hold(cRight,()=>{move(1);render();});cRotate.addEventListener('click',()=>{rotate(1);render();});cDrop.addEventListener('click',()=>{hardDrop();render();});

  window.addEventListener('keydown',(e)=>{const k=e.key;if(['ArrowLeft','ArrowRight','ArrowDown',' ','x','X','z','Z','r','R','a','A','d','D','ArrowUp'].includes(k))e.preventDefault();if(k===' '){if(over){start(true);}run();}else if(k==='r'||k==='R'){reset();}else if(k==='ArrowLeft'||k==='a'||k==='A'){move(-1);render();}else if(k==='ArrowRight'||k==='d'||k==='D'){move(1);render();}else if(k==='ArrowDown'){tickDown();render();}else if(k==='ArrowUp'||k==='x'||k==='X'){rotate(1);render();}else if(k==='z'||k==='Z'){rotate(-1);render();}}, {passive:false});

  function start(hard=false){grid=makeGrid();score=0;lines=0;level=1;over=false;running=false;dropInterval=gravityBaseMs;updateHUD();nextQueue=[];refillBag();refillBag();spawn();render();}
  start(true);render();
})();
</script>
</body>
</html>